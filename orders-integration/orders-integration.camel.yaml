- route:
    id: orders-integration
    from:
      id: from-c473
      uri: direct
      parameters:
        name: orders-integration
      steps:
        - log:
            id: log-9bf9
            message: "ðŸ“¤ Sending order to ERP: ${body}"
        - convertBodyTo:
            id: convertBodyTo-f98a
            type: String
        - removeHeaders:
            id: removeHeaders-64b3
            pattern: CamelHttp*
        - setHeader:
            id: setHeader-684d
            name: Content-Type
            expression:
              constant:
                id: constant-427a
                expression: application/json
        - to:
            id: to-4068
            uri: http
            parameters:
              httpUri: host.docker.internal:4004/api/purchase-orders
              httpMethod: POST
              authMethod: Basic
              authUsername: "{{env:ERP_USER}}"
              authPassword: "{{env:ERP_PASSWORD}}"
              bridgeEndpoint: false
        - log:
            id: log-eb19
            message: "âœ… ERP response: ${body}"
        - setHeader:
            id: setHeader-e2dd
            name: rabbitmq.CORRELATION_ID
            expression:
              simple:
                id: simple-69cd
                expression: ${exchangeProperty.savedCorrelationId}
        - log:
            id: log-a740
            message: >-
              ðŸ”™ Sending response with correlationId:
              ${header.rabbitmq.CORRELATION_ID}
        - doTry:
            id: doTry-0bbe
            doCatch:
              - id: doCatch-3c6a
                exception:
                  - java.lang.Exception
                steps:
                  - log:
                      id: log-2512
                      message: >-
                        âœ… Response sent (timeout/error ignored - message was
                        delivered)
            steps:
              - to:
                  id: to-5825
                  uri: kamelet:spring-rabbitmq-sink
                  parameters:
                    host: rabbitmq
                    port: 5672
                    exchangeName: amq.direct
                    routingKey: orders.response
              - log:
                  id: log-1c2e
                  message: âœ… Response sent successfully
