- route:
    id: orders-integration
    from:
      id: from-ec1e
      uri: direct
      parameters:
        name: orders-integration
      steps:
        - log:
            id: log-d60f
            message: "ðŸ“¤ Sending order to ERP: ${body}"
        - convertBodyTo:
            id: convertBodyTo-ba25
            type: String
        - removeHeaders:
            id: removeHeaders-9d18
            pattern: CamelHttp*
        - setHeader:
            id: setHeader-a887
            name: Content-Type
            expression:
              constant:
                id: constant-7163
                expression: application/json
        - to:
            id: to-9037
            uri: http
            parameters:
              httpUri: host.docker.internal:4004/api/purchase-orders
              httpMethod: POST
              authMethod: Basic
              authUsername: "{{env:ERP_USER}}"
              authPassword: "{{env:ERP_PASSWORD}}"
              bridgeEndpoint: false
        - log:
            id: log-e432
            message: "âœ… ERP response: ${body}"
        - setHeader:
            id: setHeader-2506
            name: rabbitmq.CORRELATION_ID
            expression:
              simple:
                id: simple-656c
                expression: ${exchangeProperty.savedCorrelationId}
        - log:
            id: log-6b58
            message: >-
              ðŸ”™ Sending response with correlationId:
              ${header.rabbitmq.CORRELATION_ID}
        - doTry:
            id: doTry-b553
            doCatch:
              - id: doCatch-0f43
                exception:
                  - java.lang.Exception
                steps:
                  - log:
                      id: log-6efd
                      message: >-
                        âœ… Response sent (timeout/error ignored - message was
                        delivered)
            steps:
              - to:
                  id: to-f88c
                  uri: kamelet:spring-rabbitmq-sink
                  parameters:
                    host: rabbitmq
                    port: 5672
                    exchangeName: amq.direct
                    routingKey: orders.response
              - log:
                  id: log-a6a0
                  message: âœ… Response sent successfully
