- route:
    id: orders-integration
    from:
      id: from-6794
      uri: direct
      parameters:
        name: orders-integration
      steps:
        - log:
            id: log-3298
            message: "ðŸ“¤ Sending order to ERP: ${body}"
        - convertBodyTo:
            id: convertBodyTo-d9fd
            type: String
        - removeHeaders:
            id: removeHeaders-0e0f
            pattern: CamelHttp*
        - setHeader:
            id: setHeader-396e
            name: Content-Type
            expression:
              constant:
                id: constant-820f
                expression: application/json
        - to:
            id: to-3a8a
            uri: http
            parameters:
              httpUri: host.docker.internal:4004/api/purchase-orders
              httpMethod: POST
              authMethod: Basic
              authUsername: "{{env:ERP_USER}}"
              authPassword: "{{env:ERP_PASSWORD}}"
              bridgeEndpoint: false
        - log:
            id: log-f3ac
            message: "âœ… ERP response: ${body}"
        - setHeader:
            id: setHeader-e499
            name: CamelSpringRabbitmqCorrelationId
            expression:
              simple:
                id: simple-2482
                expression: ${exchangeProperty.savedCorrelationId}
        - log:
            id: log-4f7c
            message: >-
              ðŸ”™ Sending response with correlationId:
              ${header.CamelSpringRabbitmqCorrelationId}
        - doTry:
            id: doTry-8349
            doCatch:
              - id: doCatch-b994
                exception:
                  - java.lang.Exception
                steps:
                  - log:
                      id: log-ec0b
                      message: >-
                        âœ… Response sent (timeout/error ignored - message was
                        delivered)
            steps:
              - to:
                  id: to-ae19
                  uri: kamelet:spring-rabbitmq-sink
                  parameters:
                    host: rabbitmq
                    port: 5672
                    exchangeName: amq.direct
                    routingKey: orders.response
              - log:
                  id: log-6aca
                  message: âœ… Response sent successfully
